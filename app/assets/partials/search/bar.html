<div ng-cloak="" class="row search-row" np-animate="#main" ng-controller_="AdvancedCtrl">
<a href="/"><img src="http://www.nextprot.org/db/images/blueflat/np.png" class="home"></a>

<div class="row">
    <form ng-submit="go()" validate="">
        <div>
            <div class="col-sm-3 col-md-3">
                <!--                        -->
                <!--  ENTITY SELECTION      -->
                <!--                        -->
                <div class="btn-group pull-right ">

                    <a class="btn dropdown-toggle btn-default" data-toggle="dropdown" href="" id="search-entity" ng-class="{disabled:isAdvancedMode()}">
                        {{Search.config.entityMapping[Search.params.entity]}}&nbsp;
                        <span class="caret"></span>
                    </a>
                    <ul id="search-entity-dropdown" class="dropdown-menu">
                        <!-- dropdown menu links -->
                        <li><a ng-click="entity({entity:'proteins'})">Proteins</a></li>
                        <li><a ng-click="entity({entity:'publications'})">Publications</a></li>
                        <li><a ng-click="entity({entity:'terms'})">Terms</a></li>
                    </ul>
                </div>
                <!--                        -->
            </div>
            <div class="search-bar col-sm-9 col-md-9">

                <div class="input-group col-sm-8 col-md-8" ng-class="{'input-group':Search.displayGold()}">
                    <!--                        -->
                    <!--  QUALITY SELECTION     -->
                    <!--                        -->
                    <div class="input-group-btn">
                        <button class="btn dropdown-toggle btn btn-default" type="button" ng-cloak="" data-toggle="dropdown" ng-show="Search.displayGold()" id="search-quality">
                            {{Search.config.widgets[Search.result.display].qualityLabel[Search.params.quality]}}
                            <span class="caret"></span>
                        </button>
                        <ul id="search-quality-dropdown" class="dropdown-menu" ng-show="Search.displayGold()">
                            <li><a ng-click="quality('gold')">Gold only</a></li>
                            <li><a ng-click="quality('gold-and-silver')">Include silver</a></li>
                        </ul>
                    </div>

                    <!--                        -->
                    <!--  SEARCH TEXT FIELD     quality selection => width:65.812%; without => width:80.8%-->
                    <!--                        -->
                    <input ng-show="!isAdvancedMode()" id="search-query" class="form-control" type="text" ng-model="Search.params.query" ng-class="{'search-width-quality':Search.displayGold(),'search-width-no-quality':!Search.displayGold()}" autocomplete="off" bs-autocomplete="Search.suggest" autofocus="">

                    <ui-codemirror id="search-query-advanced" ng-show="isAdvancedMode()" ui-codemirror-opts="editorOptions" class="btn-group search-width-advanced" ng-model="Search.params.sparql" ui-refresh="Search.params.sparql"></ui-codemirror>

                    <!--                      -->
                    <!--  CLEAN/HELP BUTTON   -->
                    <!--                      -->
                    <div class="input-group-btn">
                        <button id="search-clear" class="btn btn-circle gray btn-default btn-xs" type="button" ng-click="clean({})" ng-disabled="(!Search.params.query || !Search.params.query.length) &amp;&amp; (!Search.params.sparql || !Search.params.sparql.length)" style="margin-left: -30px; position: absolute; margin-top: 7px;z-index:10">
                            <i class="icon-remove "></i>
                        </button>
                        <button id="search-help" class="btn btn-circle gray btn-default btn-xs" type="button" ng-click="showHelpRepository()" ng-show="isAdvancedMode()" style="margin-left: -54px; position: absolute; margin-top: 5px;z-index:10">
                            <i class="icon-info-sign "></i>
                        </button>


                        <!--                        -->
                        <!--  SEARCH BUTTON         -->
                        <!--                        -->
                        <button id="search-button" class="btn btn-default" type="submit" style="z-index:10000" ng-disabled="Search.isSearchButtonDisabled()"><i class="icon-search"></i>&nbsp;Search
                        </button>
                    </div>

                </div>

                <!--                                                                  -->
                <!--  SEARCH BOTTOM ('did you mean' option and toggle search)         -->
                <!--                                                                  -->
                <div class="search-bottom">
                       <span ng-show="Search.result.spellcheck.collations.length" id="search-didyoumean"><b class="gray">&nbsp;Did you mean:</b>
                         <a href="{{Search.config.entityMapping[Search.params.entity]}}/search/{{Search.result.spellcheck.collations[0].query}}">{{Search.result.spellcheck.collations[0].query}}</a>
                         <span ng-show="Search.result.spellcheck.collations[1]">, 
                           <a href="{{Search.config.entityMapping[Search.params.entity]}}/search/{{Search.result.spellcheck.collations[1].query}}">{{Search.result.spellcheck.collations[1].query}}</a>
                         </span>
                       </span>
                    <span class=" search-toggle"><span ng-click="toggleAdv({mode:null})" ng-class="{link:isAdvancedMode()}">simple</span> / <span ng-class="{link:!isAdvancedMode()}" ng-click="toggleAdv({mode:'advanced'})">advanced</span></span>

                </div>

            </div>


        </div>
    </form>
</div>

<!--                                                                  -->
<!--  HELP / REPOSITORY                                               -->
<!--                                                                  -->
<div class="fade-out fade-in col-lg-offset-3" style="padding-left: 5px;padding: 1px; border: 1px solid #ddd;border-radius: 8px; position: absolute; background-color: white; z-index: 1000; width: 700px; box-shadow: 0 0 10px 5px lightgray" ng-show="Advanced.showHelp">


    <div class="modal-header input-group" ng-show="Advanced.isSelectedQueryEmpty()">
        <button type="button" class="close" ng-click="Advanced.showHelp=false">×</button>
        <!--filter-->
        <input type="text" ng-model="filterQuery" placeholder="search in {{Advanced.currentRepository.title}} repository" class="form-control">
        <!--Selectable repositories-->
            <button data-toggle="tooltip" title="{{rep.tooltip}}" class="btn {{(Advanced.currentRepository == rep) ? 'btn-inverse' : ''}} btn-default" ng-repeat="rep in Advanced.repositories" type="button" ng-click="showRepository(rep)"><i class="{{rep.icon}}"></i></button>
    </div>

    <div class="modal-header input-group" ng-show="!Advanced.isSelectedQueryEmpty()">

        <button type="button" class="close" ng-click="Advanced.showHelp=false">×</button>

        <!-- Title -->
        <input type="text" ng-show="Advanced.isSelectedQueryEditable()" placeholder="Name..." ng-model="Advanced.selectedQuery.title" focus="" class="span6 form-control">
        <h4 ng-hide="Advanced.isSelectedQueryEditable()">{{Advanced.selectedQuery.title}}</h4>
        <!-- Title-->
        <button data-toggle="tooltip" title="Keep the query in your private repository" ng-if="Advanced.isSelectedQueryEditable()" class="btn  {{(!Advanced.selectedQuery.published) ? 'btn-inverse' : ''}} btn-default" type="button" ng-click="Advanced.selectedQuery.published=!Advanced.selectedQuery.published">
            <i class="icon-user"></i>
        </button>
        <button data-toggle="tooltip" title="Show in the community repository" ng-if="Advanced.isSelectedQueryEditable()" class="btn  {{(Advanced.selectedQuery.published) ? 'btn-inverse' : ''}} btn-default" type="button" ng-click="Advanced.selectedQuery.published=!Advanced.selectedQuery.published">
            <i class="icon-globe"></i>
        </button>
    </div>

    <div class="modal-body" style="overflow-x:hidden;">

        <!--                                 -->
        <!-- Box for the list                -->
        <!--                                 -->
        <div class="slide-in-left slide-out-left" ng-show="Advanced.isSelectedQueryEmpty()">

            <table class="table table-striped">
                <tbody>
                <tr ng-repeat="query in Advanced.queries | filter:filterQuery | orderBy:'title'">
                    <td style="padding-left:0px;padding-right:0px">
                        <i class="{{query.published ? (query.username == 'nextprot' ? 'icon-certificate' : 'icon-globe') : ''}} gray btn-xs"></i>
                    </td>
                    <td><a href="" ng-click="setCurrentQuery(query)" class="query-title">{{query.title}}
                        [{{query.username}}]</a></td>
                    <!--Show the view button-->
                    <td class="btn-group">
                        <button class="btn btn-default btn-xs" type="button" ng-if="!hasPrivilegesToEdit(query)" ng-click="Advanced.setCurrentQuery(query)"><i class="icon-eye-open"></i></button>
                        <button class="btn btn-default btn-xs" type="button" ng-if="hasPrivilegesToEdit(query)" ng-click="Advanced.setCurrentQuery(query)"><i class="icon-edit"></i></button>
                        <button class="btn btn-default btn-xs" type="button" ng-if="hasPrivilegesToEdit(query)" ng-click="Advanced.deleteAdvancedQuery(query)"><i class="icon-remove"></i></button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>


        <!--                                 -->
        <!-- Box for editing or visualizing  -->
        <!--                                 -->
        <div class="slide-in-right slide-out-right" style="height: 300px;" ng-show="!Advanced.isSelectedQueryEmpty()">

            <!-- Sparql -->
                <div class="col-sm-6 col-md-6" style="width: 670px; margin: 15px;">
                    <ui-codemirror id="search-query-save" ui-codemirror-opts="editorOptions" class=" search-width-advanced" ng-model="Advanced.selectedQuery.sparql" ui-refresh="Advanced.selectedQuery.sparql"></ui-codemirror>


                </div>

            <!-- Description -->
            <div class="col-sm-6 col-md-6" style="width: 670px; margin: 15px;">
                <textarea ng-show="Advanced.isSelectedQueryEditable()" rows="4" id="inputDescription" class="span6" placeholder="Write some description..." ng-model="Advanced.selectedQuery.description">                </textarea>

                <p ng-hide="Advanced.isSelectedQueryEditable()">{{Advanced.selectedQuery.description}}</p>
            </div>

        </div>

    </div>

    <!-- Create new button -->
    <div class="modal-footer">

        <!-- "Create new" only if there is no query selected -->
        <button ng-show="Advanced.isSelectedQueryEmpty()" class="btn btn-primary pull-right btn-sm" type="button" ng-click="Advanced.createNewEmptyQuery();">New
        </button>

        <!-- "Save" button showed only if there is a query selected -->
        <button ng-show="Advanced.isSelectedQueryEditable()" class="btn btn-primary pull-right btn-sm" ng-click="Advanced.insertOrUpdateSelectedQuery()">Save
        </button>

        <!-- "Back" button showed only if there is a query selected -->
        <button ng-show="!Advanced.isSelectedQueryEmpty()" class="btn pull-left btn-default btn-sm" type="button" ng-click="Advanced.clearSelectedQuery();">Back
        </button>

    </div>

</div>


<div class="row solrparams">
</div>

</div>